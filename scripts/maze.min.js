const DEFAULT_HEX_SIZE=25,SQRT_3=Math.sqrt(3);var Directions=Object.freeze(["SOUTHEAST","SOUTH","SOUTHWEST","NORTHWEST","NORTH","NORTHEAST"]),Masks=Object.freeze({VISITED:1,CURSOR:2,PATH_SOUTHEAST:4,PATH_SOUTH:8,PATH_SOUTHWEST:16,PATH_NORTHWEST:32,PATH_NORTH:64,PATH_NORTHEAST:128}),ReverseDirectionMasks=Object.freeze({PATH_SOUTHEAST:Masks.PATH_NORTHWEST,PATH_SOUTH:Masks.PATH_NORTH,PATH_SOUTHWEST:Masks.PATH_NORTHEAST,PATH_NORTHWEST:Masks.PATH_SOUTHEAST,PATH_NORTH:Masks.PATH_SOUTH,PATH_NORTHEAST:Masks.PATH_SOUTHWEST}),Neighbors=Object.freeze({SOUTHEAST:[1,0],SOUTH:[0,1],SOUTHWEST:[-1,1],NORTHWEST:[-1,0],NORTH:[0,-1],NORTHEAST:[1,-1]});function getDefaultLineWidth(e){return Math.ceil(e/4)}function getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}function getNeighborIndex(e,t,r,n,o){var T=qrToIndex(...indexToQRCoords(e,t).map((e,t)=>e+Neighbors[o][t]));return!(T.some(e=>e<0)||T[0]>=r||T[1]>=n)&&T}function indexToQRCoords(e,t){return[e,t-Math.floor(e/2)]}function indexToXY(e,t,r){return qrToXY(...indexToQRCoords(e,t),r)}function qrToIndex(e,t){return[e,t+Math.floor(e/2)]}function qrToXY(e,t,r){return[3*e/2,e*SQRT_3/2+t*SQRT_3].map((e,t)=>(e+[1.5,SQRT_3/2+.1][t])*(r||DEFAULT_HEX_SIZE))}function getHexCorner(e,t,r,n){return[e+r*Math.cos(n*Math.PI/3),t+r*Math.sin(n*Math.PI/3)]}function drawHexFromArray(e,t,r,n,o){var T,i,a,s=o||DEFAULT_HEX_SIZE;for([T,i]=qrToXY(...indexToQRCoords(r,n),s),e.beginPath(),e.moveTo(...getHexCorner(T,i,s,0)),a=1;a<=6;a++)t[r][n]&Masks["PATH_"+Directions[a-1]]?e.moveTo(...getHexCorner(T,i,s,a)):e.lineTo(...getHexCorner(T,i,s,a));e.strokeStyle=t[r][n]&Masks.VISITED?"#FFFFFF":"#FF00FF",e.lineWidth=getDefaultLineWidth(s),e.stroke(),t[r][n]&Masks.CURSOR?(e.fillStyle="#00FF00",e.fillRect(T-.25*s,i-.25*s,s/2,s/2)):e.clearRect(T-.3*s,i-.3*s,.62*s,.62*s)}function Maze(e,t,r,n,o,T){"use strict";if(!e||!e.getContext)throw"Could not initialize Game. Argument must be a valid canvas element.";var i,a=T>0?T:30,s=e,H=o,S=!1,c=s.getContext("2d"),f=(n=n||DEFAULT_HEX_SIZE,[[0,0]]),h=[...Array(t||10)].map(e=>new Uint8Array(r||10).fill(0)),A=!1,u=Date.now(),l=function(e){if(!f.length)return!1;var n,o,T,i,a,s=!1!==e,H=[];for([n,o]=f[f.length-1],s&&R(n,o),h[n][o]|=Masks.VISITED|Masks.CURSOR,T=0;T<Directions.length;T++)!(a=getNeighborIndex(n,o,t,r,Directions[T]))||h[a[0]][a[1]]&Masks.VISITED||H.push([Directions[T],a]);return H.length?([i,T]=H[getRandomInt(H.length)],h[n][o]|=Masks["PATH_"+i],h[T[0]][T[1]]|=ReverseDirectionMasks["PATH_"+i],f.push(T)):f.pop(),s&&O(n,o),h[n][o]^=Masks.CURSOR,!0},R=function(e,t){var r,o;[r,o]=indexToXY(e,t,n),c.clearRect(r-1.7*n,o-(SQRT_3+.2)*n,3.4*n,2*(SQRT_3+.2)*n)},E=function(){c.clearRect(0,0,s.width,s.height)},O=function(e,o){var T,i;[T,i]=indexToXY(e,o,n),Directions.map(n=>getNeighborIndex(e,o,t,r,n)).filter((e,t)=>!!e&&h[e[0]][e[1]]|Masks.VISITED).forEach(e=>{drawHexFromArray(c,h,...e,n)}),drawHexFromArray(c,h,e,o,n)},d=function(e){var t,r;if(!H||e)for(t=0;t<h.length;t++)for(r=0;r<h[t].length;r++)drawHexFromArray(c,h,t,r,n)},_=function(){var e=Date.now(),t=e-u,r=!0;t>1e3/a&&(u=e-t%(1e3/a),r=l()),r&&A?i=requestAnimationFrame(_):A=!1};this.startGame=function(){A||(S&&(d(),S=!1),i=requestAnimationFrame(_),A=!0)},this.stopGame=function(){A&&(cancelAnimationFrame(i),A=!1)},this.resetGame=function(){A&&this.stopGame(),E(),f=[[0,0]],h=[...Array(t||10)].map(e=>new Uint8Array(r||10).fill(0)),d()},this.renderMaze=function(e){e&&this.resetGame(),E(),c.fillStyle="#FFCCFF",c.font="40px san-serif";var t="Generating Maze, Please Wait...",r=c.measureText(t).width,n=c.measureText("M").width;c.fillText(t,s.width/2-r/2,s.height/2-n/2),setTimeout(()=>{for(;l(!1););E(),d(!0)},100)},this.clear=function(){E()},this.setHollow=function(e){S=e&&!H,H=e},this.setPerSecond=function(e){a=e||30},E(),d()}